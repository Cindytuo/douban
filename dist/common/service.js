"use strict";var face=require("./face"),fake=require("./fake"),Promise=require("../util/es6-promise.min").Promise,get=!1,requestApi=function(e,t){var n=new Promise(function(n,i){wx.request({url:e,data:Object.assign({},t),header:{"Content-Type":"json"},success:function(e){n(e)},fail:function(e){i(e)}})});return extendPromise(n),n},requestFakeApi=function(e,t){var n=new Promise(function(t,n){setTimeout(function(){t({data:e}),get=!0},2e3),setTimeout(function(){get||n({data:{code:333,msg:"访问错误"}})},4e3)});return extendPromise(n),n},extendPromise=function(e){e.success=function(t){return e.then(function(e){t(e)}),e},e.error=function(t){return e.then(null,function(e){t(e)}),e}},getIntheaters=function(e){var t=void 0==e.city?"北京":e.city,n=void 0==e.start?0:e.start,i=void 0==e.count?20:e.count;return requestApi(face.intheaters,{city:t,start:n,count:i})},getTop=function(e){var t=void 0==e.city?"北京":e.city,n=void 0==e.start?0:e.start,i=void 0==e.count?20:e.count;return requestApi(face.top,{city:t,start:n,count:i})},getOneSubject=function(e){return requestApi(""+face.subject+e.id)},getReviews=function(){return requestFakeApi(fake.getReview,null)};module.exports={getIntheaters:getIntheaters,getTop:getTop,getReviews:getReviews,getOneSubject:getOneSubject};